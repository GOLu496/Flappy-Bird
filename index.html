<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Flappy Bird Pro Max - Ultra Edition</title>
  <style>
    :root {
      --bg: #1a1a1a;
      --accent: #22c55e;
      --accent2: #06b6d4;
    }
    html, body {
      height: 100%; margin: 0; padding: 0;
      background: #7dd3fc; color: #fff;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden; touch-action: none;
    }
    #wrap {
      position: absolute; inset: 0;
      width: 100vw; height: 100vh;
      display: flex; justify-content: center; align-items: center;
    }
    canvas {
      display: block; width: 100vw; height: 100vh; object-fit: fill; 
    }
    .overlay {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      pointer-events: none; z-index: 10;
    }
    .panel {
      pointer-events: auto; background: rgba(0, 0, 0, 0.85);
      padding: 30px; border-radius: 24px; text-align: center;
      backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.1);
      width: 85%; max-width: 320px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    .title { font-size: 32px; font-weight: 900; margin-bottom: 10px; color: #fbbf24; letter-spacing: 2px; }
    #medalBox { font-size: 50px; margin: 15px 0; display: none; }
    button {
      appearance: none; border: 0; padding: 15px 30px;
      border-radius: 14px; font-weight: 800; font-size: 18px;
      cursor: pointer; background: var(--accent); color: #fff;
      width: 100%; text-transform: uppercase; margin-top: 10px;
    }
    #startPanel, #gameOverPanel { display: none; }
  </style>
</head>
<body>
  <div id="wrap">
    <canvas id="game"></canvas>
    <div class="overlay">
      <div id="startPanel" class="panel">
        <div class="title">FLAPPY</div>
        <button id="startBtn">Fly Now</button>
      </div>
      <div id="gameOverPanel" class="panel">
        <div class="title">RESULTS</div>
        <div id="medalBox"><span id="medalEmoji">ðŸ¥‰</span></div>
        <div id="scoreLine" style="font-size: 18px; margin-bottom: 10px;">Score: 0<br>Best: 0</div>
        <button id="restartBtn" style="background: var(--accent2)">Retry</button>
      </div>
    </div>
  </div>

  <script>
  (function() {
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    let GAME_W = window.innerWidth, GAME_H = window.innerHeight;
    const GRAVITY = 1600, FLAP_VY = -450, PIPE_WIDTH = 80, PIPE_GAP = 185, GROUND_H = 100;
    
    let state = 'ready', score = 0, best = parseInt(localStorage.getItem('fb_best_v4') || '0');
    let bird = { x: 0, y: 0, vy: 0, rot: 0, wing: 0 };
    let pipes = [], clouds = [], floatingTexts = [], screenShake = 0;
    let lastTime = 0, flashOpacity = 0, scoreScale = 1;

    function resize() {
        GAME_W = window.innerWidth; GAME_H = window.innerHeight;
        canvas.width = GAME_W; canvas.height = GAME_H;
        bird.x = GAME_W * 0.25;
    }
    window.addEventListener('resize', resize); resize();

    function reset() {
        score = 0; bird.y = GAME_H / 2; bird.vy = 0;
        pipes = []; floatingTexts = []; screenShake = 0; state = 'ready';
        document.getElementById('startPanel').style.display = 'block';
        document.getElementById('gameOverPanel').style.display = 'none';
        document.getElementById('medalBox').style.display = 'none';
    }

    document.getElementById('startBtn').onclick = (e) => { e.stopPropagation(); state = 'playing'; document.getElementById('startPanel').style.display = 'none'; };
    document.getElementById('restartBtn').onclick = (e) => { e.stopPropagation(); reset(); };

    window.addEventListener('pointerdown', (e) => {
        if (e.target.tagName === 'BUTTON') return;
        if (state === 'playing') bird.vy = FLAP_VY;
        else if (state === 'ready') { state = 'playing'; document.getElementById('startPanel').style.display = 'none'; }
    });

    function gameOver() {
        if (state === 'gameover') return;
        state = 'gameover'; flashOpacity = 0.8; screenShake = 15; // Screen shake trigger
        best = Math.max(best, score);
        localStorage.setItem('fb_best_v4', best);
        setTimeout(() => {
            document.getElementById('scoreLine').innerHTML = `Score: ${score}<br>Best: ${best}`;
            if (score >= 5) {
                document.getElementById('medalEmoji').innerText = score >= 30 ? "ðŸ¥‡" : (score >= 15 ? "ðŸ¥ˆ" : "ðŸ¥‰");
                document.getElementById('medalBox').style.display = 'block';
            }
            document.getElementById('gameOverPanel').style.display = 'block';
        }, 500);
    }

    function update(dt) {
        if (state === 'ready') { bird.y = (GAME_H/2) + Math.sin(performance.now() / 200) * 15; return; }
        if (screenShake > 0) screenShake -= dt * 40;
        if (state === 'gameover') return;

        bird.vy += GRAVITY * dt; bird.y += bird.vy * dt;
        bird.rot = Math.min(Math.PI/3, Math.max(-Math.PI/10, bird.vy / 900));

        if (pipes.length === 0 || pipes[pipes.length-1].x < GAME_W - 320) {
            pipes.push({ x: GAME_W, topH: Math.random() * (GAME_H - GROUND_H - PIPE_GAP - 120) + 60, passed: false });
        }

        pipes.forEach(p => {
            p.x -= 250 * dt;
            if (bird.x+15 > p.x && bird.x-15 < p.x + PIPE_WIDTH) {
                if (bird.y-15 < p.topH || bird.y+15 > p.topH + PIPE_GAP) gameOver();
            }
            if (!p.passed && p.x + PIPE_WIDTH/2 < bird.x) { 
                p.passed = true; score++; scoreScale = 1.4;
                floatingTexts.push({ x: bird.x, y: bird.y, alpha: 1 }); // Score Ghost Effect
            }
        });
        pipes = pipes.filter(p => p.x > -100);
        floatingTexts.forEach(t => { t.y -= 50 * dt; t.alpha -= dt; });
        floatingTexts = floatingTexts.filter(t => t.alpha > 0);

        if (bird.y > GAME_H - GROUND_H || bird.y < 0) gameOver();
        if (flashOpacity > 0) flashOpacity -= dt * 2;
        if (scoreScale > 1) scoreScale -= dt * 2;
    }

    function draw() {
        ctx.save();
        if (screenShake > 0) ctx.translate(Math.random()*screenShake, Math.random()*screenShake);

        ctx.fillStyle = '#7dd3fc'; ctx.fillRect(0, 0, GAME_W, GAME_H);
        
        // Clouds
        ctx.fillStyle = 'rgba(255,255,255,0.7)';
        if (Math.random() < 0.01) clouds.push({x: GAME_W, y: Math.random()*200, s: Math.random()*0.5+0.2, w: 60+Math.random()*40});
        clouds.forEach(c => { c.x -= 70 * c.s * 0.016; ctx.beginPath(); ctx.ellipse(c.x, c.y, c.w, c.w/2, 0, 0, Math.PI*2); ctx.fill(); });

        // Pipes
        pipes.forEach(p => {
            ctx.fillStyle = '#22c55e'; ctx.fillRect(p.x, 0, PIPE_WIDTH, p.topH);
            ctx.fillRect(p.x, p.topH + PIPE_GAP, PIPE_WIDTH, GAME_H);
            ctx.fillStyle = '#166534'; ctx.fillRect(p.x-5, p.topH-25, PIPE_WIDTH+10, 25);
            ctx.fillRect(p.x-5, p.topH+PIPE_GAP, PIPE_WIDTH+10, 25);
        });

        // Ground
        ctx.fillStyle = '#5d4037'; ctx.fillRect(0, GAME_H-GROUND_H, GAME_W, GROUND_H);
        ctx.fillStyle = '#8bc34a'; ctx.fillRect(0, GAME_H-GROUND_H, GAME_W, 15);

        // Bird
        ctx.save();
        ctx.translate(bird.x, bird.y); ctx.rotate(bird.rot);
        ctx.fillStyle = '#fbbf24'; ctx.beginPath(); ctx.roundRect(-20, -15, 40, 30, 12); ctx.fill();
        ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(12, -6, 6, 0, 7); ctx.fill();
        ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(14, -6, 2, 0, 7); ctx.fill();
        ctx.fillStyle = '#ef4444'; ctx.beginPath(); ctx.moveTo(18, 0); ctx.lineTo(30, 5); ctx.lineTo(18, 10); ctx.fill();
        ctx.restore();

        // Ghost Score Text
        floatingTexts.forEach(t => {
            ctx.globalAlpha = t.alpha; ctx.fillStyle = 'white'; ctx.font = 'bold 30px sans-serif';
            ctx.fillText("+1", t.x, t.y);
        });
        ctx.globalAlpha = 1;

        if (state === 'playing') {
            ctx.save(); ctx.translate(GAME_W/2, 80); ctx.scale(scoreScale, scoreScale);
            ctx.fillStyle = 'white'; ctx.font = 'bold 60px sans-serif'; ctx.textAlign = 'center';
            ctx.fillText(score, 0, 0); ctx.restore();
        }
        ctx.restore();

        if (flashOpacity > 0) { ctx.fillStyle = `rgba(255,255,255,${flashOpacity})`; ctx.fillRect(0,0,GAME_W,GAME_H); }
    }

    function loop(ts) {
        let dt = Math.min(0.1, (ts - lastTime) / 1000);
        lastTime = ts; update(dt); draw();
        requestAnimationFrame(loop);
    }
    reset(); requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>